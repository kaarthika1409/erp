{"ast":null,"code":"import axios from 'axios';\n\n// Use the full URL to the backend\nconst API_BASE_URL = 'http://localhost:5000/api';\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  withCredentials: true\n});\n\n// Add token to requests if it exists\napi.interceptors.request.use(config => {\n  var _config$method;\n  // Always get the latest token from localStorage\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n    console.log('Added auth token to request headers');\n  } else {\n    console.warn('No auth token found in localStorage');\n    // If we're not on the login page and there's no token, redirect to login\n    if (window.location.pathname !== '/login') {\n      console.log('Redirecting to login...');\n      window.location.href = '/login';\n    }\n  }\n  console.log('Making request to:', (_config$method = config.method) === null || _config$method === void 0 ? void 0 : _config$method.toUpperCase(), config.url);\n  if (config.data) {\n    console.log('Request data:', config.data);\n  }\n  return config;\n}, error => {\n  console.error('Request Error:', error);\n  return Promise.reject(error);\n});\n\n// Add response interceptor to handle 401 Unauthorized errors\napi.interceptors.response.use(response => {\n  return response;\n}, error => {\n  var _error$response;\n  const originalRequest = error.config;\n\n  // If error is 401 and we haven't tried to refresh the token yet\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry) {\n    console.log('Token expired, attempting to refresh...');\n\n    // Prevent infinite loops\n    originalRequest._retry = true;\n\n    // Try to refresh the token\n    return api.post('/auth/refresh-token').then(response => {\n      if (response.status === 200) {\n        const {\n          token\n        } = response.data;\n        localStorage.setItem('token', token);\n\n        // Update the Authorization header\n        originalRequest.headers.Authorization = `Bearer ${token}`;\n\n        // Retry the original request with the new token\n        return api(originalRequest);\n      }\n    }).catch(refreshError => {\n      console.error('Failed to refresh token:', refreshError);\n      // If refresh token fails, redirect to login\n      if (window.location.pathname !== '/login') {\n        localStorage.removeItem('token');\n        window.location.href = '/login';\n      }\n      return Promise.reject(refreshError);\n    });\n  }\n\n  // If the error is not 401 or we've already tried to refresh, just reject\n  return Promise.reject(error);\n});\n\n// Handle responses\napi.interceptors.response.use(response => {\n  console.log('Response from', response.config.url, ':', response.data);\n  return response;\n}, error => {\n  var _error$response2, _error$response2$data, _error$config, _error$response3, _error$response4, _error$response5;\n  const errorMessage = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.error) || error.message || 'An error occurred';\n  console.error('API Error:', {\n    url: (_error$config = error.config) === null || _error$config === void 0 ? void 0 : _error$config.url,\n    status: (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status,\n    data: (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.data,\n    message: error.message\n  });\n  if (((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.status) === 401) {\n    localStorage.removeItem('token');\n    // Only redirect if not already on login page\n    if (!window.location.pathname.includes('login')) {\n      window.location.href = '/login';\n    }\n  }\n  return Promise.reject(errorMessage);\n});\nexport default api;","map":{"version":3,"names":["axios","API_BASE_URL","api","create","baseURL","headers","withCredentials","interceptors","request","use","config","_config$method","token","localStorage","getItem","Authorization","console","log","warn","window","location","pathname","href","method","toUpperCase","url","data","error","Promise","reject","response","_error$response","originalRequest","status","_retry","post","then","setItem","catch","refreshError","removeItem","_error$response2","_error$response2$data","_error$config","_error$response3","_error$response4","_error$response5","errorMessage","message","includes"],"sources":["C:/Users/kaart/OneDrive/Desktop/pavakie/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\n// Use the full URL to the backend\nconst API_BASE_URL = 'http://localhost:5000/api';\n\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  withCredentials: true\n});\n\n// Add token to requests if it exists\napi.interceptors.request.use(\n  (config) => {\n    // Always get the latest token from localStorage\n    const token = localStorage.getItem('token');\n    \n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n      console.log('Added auth token to request headers');\n    } else {\n      console.warn('No auth token found in localStorage');\n      // If we're not on the login page and there's no token, redirect to login\n      if (window.location.pathname !== '/login') {\n        console.log('Redirecting to login...');\n        window.location.href = '/login';\n      }\n    }\n    \n    console.log('Making request to:', config.method?.toUpperCase(), config.url);\n    if (config.data) {\n      console.log('Request data:', config.data);\n    }\n    return config;\n  },\n  (error) => {\n    console.error('Request Error:', error);\n    return Promise.reject(error);\n  }\n);\n\n// Add response interceptor to handle 401 Unauthorized errors\napi.interceptors.response.use(\n  (response) => {\n    return response;\n  },\n  (error) => {\n    const originalRequest = error.config;\n    \n    // If error is 401 and we haven't tried to refresh the token yet\n    if (error.response?.status === 401 && !originalRequest._retry) {\n      console.log('Token expired, attempting to refresh...');\n      \n      // Prevent infinite loops\n      originalRequest._retry = true;\n      \n      // Try to refresh the token\n      return api.post('/auth/refresh-token')\n        .then(response => {\n          if (response.status === 200) {\n            const { token } = response.data;\n            localStorage.setItem('token', token);\n            \n            // Update the Authorization header\n            originalRequest.headers.Authorization = `Bearer ${token}`;\n            \n            // Retry the original request with the new token\n            return api(originalRequest);\n          }\n        })\n        .catch(refreshError => {\n          console.error('Failed to refresh token:', refreshError);\n          // If refresh token fails, redirect to login\n          if (window.location.pathname !== '/login') {\n            localStorage.removeItem('token');\n            window.location.href = '/login';\n          }\n          return Promise.reject(refreshError);\n        });\n    }\n    \n    // If the error is not 401 or we've already tried to refresh, just reject\n    return Promise.reject(error);\n  }\n);\n\n// Handle responses\napi.interceptors.response.use(\n  (response) => {\n    console.log('Response from', response.config.url, ':', response.data);\n    return response;\n  },\n  (error) => {\n    const errorMessage = error.response?.data?.error || error.message || 'An error occurred';\n    \n    console.error('API Error:', {\n      url: error.config?.url,\n      status: error.response?.status,\n      data: error.response?.data,\n      message: error.message\n    });\n    \n    if (error.response?.status === 401) {\n      localStorage.removeItem('token');\n      // Only redirect if not already on login page\n      if (!window.location.pathname.includes('login')) {\n        window.location.href = '/login';\n      }\n    }\n    \n    return Promise.reject(errorMessage);\n  }\n);\n\nexport default api;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}